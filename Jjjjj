--[[
    Devil Spy v3.0 (Anti-Cheat Evasion)
    Advanced remote spy with anti-detection
    Color Scheme: Black, Dark Gray, Dark Purple, Purple
]]

-- Anti-anti-cheat measures
do
    -- Prevent gcinfo detection by using incremental garbage collection
    local function safeGC()
        local originalGC = gcinfo
        local callCount = 0
        local lastCall = tick()
        
        return function()
            callCount = callCount + 1
            local currentTime = tick()
            
            -- Only allow gcinfo calls with reasonable intervals
            if currentTime - lastCall < 0.1 then
                return 0
            end
            
            lastCall = currentTime
            
            -- Return cached value for rapid succession calls
            if callCount % 10 == 0 then
                return originalGC()
            else
                return 0
            end
        end
    end
    
    -- Replace gcinfo with safe version
    if type(gcinfo) == "function" then
        local realGC = gcinfo
        _G.gcinfo = safeGC()
        
        -- Restore for legitimate uses
        spawn(function()
            while true do
                wait(5)
                _G.gcinfo = realGC
                wait(0.1)
                _G.gcinfo = safeGC()
            end
        end)
    end
end

-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")
local HttpService = game:GetService("HttpService")

-- Random identifier for stealth
local spyId = "DEVIL_" .. tostring(math.random(10000, 99999))
local sessionKey = HttpService:GenerateGUID(false):sub(1, 12)

-- Create main GUI
local DevilSpy = Instance.new("ScreenGui")
DevilSpy.Name = spyId
DevilSpy.ResetOnSpawn = false
DevilSpy.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
DevilSpy.IgnoreGuiInset = true

-- Toggle button (Dark Purple)
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "DevilToggle"
ToggleBtn.Parent = DevilSpy
ToggleBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple
ToggleBtn.BackgroundTransparency = 0.2
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Position = UDim2.new(0, 20, 0, 20)
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Text = "ðŸ‘¿"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextSize = 22
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.AutoButtonColor = true
ToggleBtn.Active = true
ToggleBtn.Draggable = true

-- Make it round
local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(1, 0)
ToggleCorner.Parent = ToggleBtn

-- Glow effect
local ToggleGlow = Instance.new("UIStroke")
ToggleGlow.Color = Color3.fromRGB(138, 43, 226) -- Purple
ToggleGlow.Thickness = 2
ToggleGlow.Transparency = 0.5
ToggleGlow.Parent = ToggleBtn

-- Main window (Black/Dark Gray)
local MainWindow = Instance.new("Frame")
MainWindow.Name = "DevilWindow"
MainWindow.Parent = DevilSpy
MainWindow.BackgroundColor3 = Color3.fromRGB(15, 15, 20) -- Almost Black
MainWindow.BackgroundTransparency = 0.05
MainWindow.BorderSizePixel = 0
MainWindow.Position = UDim2.new(0.5, -275, 0.5, -200)
MainWindow.Size = UDim2.new(0, 550, 0, 400)
MainWindow.Visible = false
MainWindow.Active = true
MainWindow.Selectable = true
MainWindow.Draggable = true

-- Window styling
local WindowCorner = Instance.new("UICorner")
WindowCorner.CornerRadius = UDim.new(0, 15)
WindowCorner.Parent = MainWindow

local WindowStroke = Instance.new("UIStroke")
WindowStroke.Color = Color3.fromRGB(75, 0, 130) -- Dark Purple
WindowStroke.Thickness = 2
WindowStroke.Parent = MainWindow

-- Top bar (Dark Gray)
local TopBar = Instance.new("Frame")
TopBar.Name = "TopBar"
TopBar.Parent = MainWindow
TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40) -- Dark Gray
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 45)

local TopBarCorner = Instance.new("UICorner")
TopBarCorner.CornerRadius = UDim.new(0, 15, 0, 0)
TopBarCorner.Parent = TopBar

-- Title (Purple)
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = TopBar
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 20, 0, 0)
Title.Size = UDim2.new(0, 200, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "DEVIL SPY"
Title.TextColor3 = Color3.fromRGB(138, 43, 226) -- Purple
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Status button
local StatusBtn = Instance.new("TextButton")
StatusBtn.Name = "Status"
StatusBtn.Parent = TopBar
StatusBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple
StatusBtn.BorderSizePixel = 0
StatusBtn.Position = UDim2.new(1, -130, 0, 10)
StatusBtn.Size = UDim2.new(0, 100, 0, 25)
StatusBtn.Font = Enum.Font.GothamBold
StatusBtn.Text = "ACTIVE"
StatusBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusBtn.TextSize = 12
StatusBtn.AutoButtonColor = false

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 5)
StatusCorner.Parent = StatusBtn

-- Close button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Name = "Close"
CloseBtn.Parent = TopBar
CloseBtn.BackgroundTransparency = 1
CloseBtn.Position = UDim2.new(1, -45, 0, 0)
CloseBtn.Size = UDim2.new(0, 45, 1, 0)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "Ã—"
CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseBtn.TextSize = 28
CloseBtn.AutoButtonColor = true

-- Content area
local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Parent = MainWindow
Content.BackgroundTransparency = 1
Content.Position = UDim2.new(0, 0, 0, 45)
Content.Size = UDim2.new(1, 0, 1, -45)

-- Left panel (Remote logs) - Dark Gray
local LeftPanel = Instance.new("Frame")
LeftPanel.Name = "LogsPanel"
LeftPanel.Parent = Content
LeftPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 35) -- Dark Gray
LeftPanel.BorderSizePixel = 0
LeftPanel.Size = UDim2.new(0, 220, 1, 0)

-- Logs title
local LogsTitle = Instance.new("TextLabel")
LogsTitle.Name = "LogsTitle"
LogsTitle.Parent = LeftPanel
LogsTitle.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
LogsTitle.BorderSizePixel = 0
LogsTitle.Size = UDim2.new(1, 0, 0, 35)
LogsTitle.Font = Enum.Font.Gotham
LogsTitle.Text = "REMOTE LOGS"
LogsTitle.TextColor3 = Color3.fromRGB(180, 180, 180)
LogsTitle.TextSize = 14

-- Logs list
local LogsList = Instance.new("ScrollingFrame")
LogsList.Name = "LogsList"
LogsList.Parent = LeftPanel
LogsList.BackgroundTransparency = 1
LogsList.BorderSizePixel = 0
LogsList.Position = UDim2.new(0, 0, 0, 35)
LogsList.Size = UDim2.new(1, 0, 1, -35)
LogsList.CanvasSize = UDim2.new(0, 0, 0, 0)
LogsList.ScrollBarThickness = 4
LogsList.ScrollBarImageColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple

local LogsLayout = Instance.new("UIListLayout")
LogsLayout.Parent = LogsList
LogsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
LogsLayout.SortOrder = Enum.SortOrder.LayoutOrder
LogsLayout.Padding = UDim.new(0, 3)

-- Right panel (Code/Buttons) - Black
local RightPanel = Instance.new("Frame")
RightPanel.Name = "CodePanel"
RightPanel.Parent = Content
RightPanel.BackgroundColor3 = Color3.fromRGB(10, 10, 15) -- Black
RightPanel.BorderSizePixel = 0
RightPanel.Position = UDim2.new(0, 220, 0, 0)
RightPanel.Size = UDim2.new(1, -220, 1, 0)

-- Code box
local CodeBox = Instance.new("TextBox")
CodeBox.Name = "CodeBox"
CodeBox.Parent = RightPanel
CodeBox.BackgroundColor3 = Color3.fromRGB(5, 5, 10)
CodeBox.BorderSizePixel = 0
CodeBox.Position = UDim2.new(0, 15, 0, 15)
CodeBox.Size = UDim2.new(1, -30, 0.65, -20)
CodeBox.Font = Enum.Font.Code
CodeBox.Text = "-- Devil Spy v3.0 | Session: " .. sessionKey .. "\n-- Select a remote to view generated script"
CodeBox.TextColor3 = Color3.fromRGB(220, 220, 220)
CodeBox.TextSize = 12
CodeBox.TextXAlignment = Enum.TextXAlignment.Left
CodeBox.TextYAlignment = Enum.TextYAlignment.Top
CodeBox.ClearTextOnFocus = false
CodeBox.MultiLine = true
CodeBox.TextWrapped = true

-- Buttons panel
local ButtonsPanel = Instance.new("Frame")
ButtonsPanel.Name = "ButtonsPanel"
ButtonsPanel.Parent = RightPanel
ButtonsPanel.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
ButtonsPanel.BorderSizePixel = 0
ButtonsPanel.Position = UDim2.new(0, 0, 0.65, 0)
ButtonsPanel.Size = UDim2.new(1, 0, 0.35, 0)

local ButtonsGrid = Instance.new("UIGridLayout")
ButtonsGrid.Parent = ButtonsPanel
ButtonsGrid.HorizontalAlignment = Enum.HorizontalAlignment.Center
ButtonsGrid.VerticalAlignment = Enum.VerticalAlignment.Center
ButtonsGrid.SortOrder = Enum.SortOrder.LayoutOrder
ButtonsGrid.CellPadding = UDim2.new(0, 10, 0, 10)
ButtonsGrid.CellSize = UDim2.new(0, 120, 0, 35)

-- Templates
local RemoteTemplate = Instance.new("Frame")
RemoteTemplate.Name = "RemoteTemplate"
RemoteTemplate.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
RemoteTemplate.BorderSizePixel = 0
RemoteTemplate.Size = UDim2.new(0.95, 0, 0, 40)

local RemoteCorner = Instance.new("UICorner")
RemoteCorner.CornerRadius = UDim.new(0, 8)
RemoteCorner.Parent = RemoteTemplate

local RemoteStroke = Instance.new("UIStroke")
RemoteStroke.Color = Color3.fromRGB(75, 0, 130) -- Dark Purple
RemoteStroke.Thickness = 1
RemoteStroke.Parent = RemoteTemplate

local RemoteBtn = Instance.new("TextButton")
RemoteBtn.Name = "Button"
RemoteBtn.Parent = RemoteTemplate
RemoteBtn.BackgroundTransparency = 1
RemoteBtn.Size = UDim2.new(1, 0, 1, 0)
RemoteBtn.Font = Enum.Font.Gotham
RemoteBtn.Text = ""
RemoteBtn.TextColor3 = Color3.new(0, 0, 0)
RemoteBtn.TextSize = 14
RemoteBtn.AutoButtonColor = false

local RemoteText = Instance.new("TextLabel")
RemoteText.Name = "Text"
RemoteText.Parent = RemoteTemplate
RemoteText.BackgroundTransparency = 1
RemoteText.Position = UDim2.new(0, 15, 0, 0)
RemoteText.Size = UDim2.new(1, -30, 1, 0)
RemoteText.Font = Enum.Font.Gotham
RemoteText.Text = "RemoteName"
RemoteText.TextColor3 = Color3.fromRGB(220, 220, 220)
RemoteText.TextSize = 12
RemoteText.TextXAlignment = Enum.TextXAlignment.Left
RemoteText.TextTruncate = Enum.TextTruncate.AtEnd

local ButtonTemplate = Instance.new("Frame")
ButtonTemplate.Name = "ButtonTemplate"
ButtonTemplate.BackgroundColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple
ButtonTemplate.BorderSizePixel = 0
ButtonTemplate.Size = UDim2.new(0, 120, 0, 35)

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 6)
ButtonCorner.Parent = ButtonTemplate

local ButtonBtn = Instance.new("TextButton")
ButtonBtn.Name = "Button"
ButtonBtn.Parent = ButtonTemplate
ButtonBtn.BackgroundTransparency = 1
ButtonBtn.Size = UDim2.new(1, 0, 1, 0)
ButtonBtn.Font = Enum.Font.Gotham
ButtonBtn.Text = ""
ButtonBtn.TextColor3 = Color3.new(0, 0, 0)
ButtonBtn.TextSize = 14
ButtonBtn.AutoButtonColor = false

local ButtonText = Instance.new("TextLabel")
ButtonText.Name = "Text"
ButtonText.Parent = ButtonTemplate
ButtonText.BackgroundTransparency = 1
ButtonText.Size = UDim2.new(1, 0, 1, 0)
ButtonText.Font = Enum.Font.GothamBold
ButtonText.Text = "Button"
ButtonText.TextColor3 = Color3.fromRGB(255, 255, 255)
ButtonText.TextSize = 12

-- Anti-detection variables
local isSpyActive = false
local isWindowVisible = false
local selectedRemote = nil
local remoteLogs = {}
local loggedRemotes = {}
local lastGCCheck = tick()
local gcBuffer = {}

-- Safe garbage collection monitoring
local function safeGCMonitor()
    local currentTime = tick()
    if currentTime - lastGCCheck > 5 then
        lastGCCheck = currentTime
        
        -- Clean buffer periodically
        if #gcBuffer > 100 then
            for i = 1, 50 do
                table.remove(gcBuffer, 1)
            end
        end
        return true
    end
    return false
end

-- Lightweight deep copy to avoid gcinfo detection
local function lightCopy(value, depth)
    depth = depth or 0
    if depth > 3 then return "[[DeepCopyLimit]]" end
    
    local valueType = typeof(value)
    
    if valueType == "table" then
        local copy = {}
        local count = 0
        for k, v in pairs(value) do
            if count < 10 then  -- Limit table size
                copy[lightCopy(k, depth + 1)] = lightCopy(v, depth + 1)
                count = count + 1
            end
        end
        return copy
    elseif valueType == "Instance" then
        return tostring(value)
    elseif valueType == "string" then
        if #value > 100 then
            return value:sub(1, 100) .. "..."
        end
        return value
    else
        return value
    end
end

-- Generate safe script
local function generateSafeScript(remote, args)
    local scriptText = "-- Generated by Devil Spy\n"
    scriptText = scriptText .. "-- Anti-detection: " .. sessionKey .. "\n\n"
    
    scriptText = scriptText .. "local remote = " .. tostring(remote) .. "\n"
    
    if args and #args > 0 then
        scriptText = scriptText .. "local args = {\n"
        for i, v in ipairs(args) do
            if i <= 5 then  -- Limit args to prevent stack overflow
                scriptText = scriptText .. "    [" .. i .. "] = "
                
                local vType = typeof(v)
                if vType == "string" then
                    scriptText = scriptText .. string.format("%q", v:sub(1, 50))
                elseif vType == "number" then
                    scriptText = scriptText .. tostring(v)
                elseif vType == "boolean" then
                    scriptText = scriptText .. tostring(v)
                elseif vType == "Instance" then
                    scriptText = scriptText .. tostring(v)
                else
                    scriptText = scriptText .. "nil -- [[Complex Type]]"
                end
                
                scriptText = scriptText .. ",\n"
            end
        end
        scriptText = scriptText .. "}\n\n"
        scriptText = scriptText .. "remote:FireServer(unpack(args))"
    else
        scriptText = scriptText .. "remote:FireServer()"
    end
    
    return scriptText
end

-- Add remote log (with anti-detection)
local function addRemoteLog(remoteType, remoteName, remoteObj, args)
    safeGCMonitor()
    
    -- Create log frame
    local logFrame = RemoteTemplate:Clone()
    logFrame.Text.Text = remoteName
    
    -- Color based on type
    if remoteType == "event" then
        logFrame.UIStroke.Color = Color3.fromRGB(138, 43, 226) -- Purple
    else
        logFrame.UIStroke.Color = Color3.fromRGB(75, 0, 130) -- Dark Purple
    end
    
    -- Generate safe script
    local safeArgs = lightCopy(args)
    local scriptText = generateSafeScript(remoteObj, safeArgs)
    
    -- Store log
    local logEntry = {
        name = remoteName,
        type = remoteType,
        remote = remoteObj,
        script = scriptText,
        frame = logFrame,
        timestamp = tick()
    }
    
    table.insert(remoteLogs, 1, logEntry)
    
    -- Connect click event
    logFrame.Button.MouseButton1Click:Connect(function()
        if selectedRemote then
            TweenService:Create(selectedRemote.frame, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(40, 40, 50)
            }):Play()
        end
        
        selectedRemote = logEntry
        TweenService:Create(logFrame, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        }):Play()
        
        CodeBox.Text = scriptText
    end)
    
    -- Add to UI
    logFrame.Parent = LogsList
    LogsList.CanvasSize = UDim2.fromOffset(LogsLayout.AbsoluteContentSize.X, LogsLayout.AbsoluteContentSize.Y)
    
    -- Limit logs
    if #remoteLogs > 50 then
        local oldLog = remoteLogs[#remoteLogs]
        if oldLog.frame then
            oldLog.frame:Destroy()
        end
        table.remove(remoteLogs, #remoteLogs)
    end
end

-- Create function button
local function createButton(name, description, onClick)
    local button = ButtonTemplate:Clone()
    button.Text.Text = name
    
    button.Button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(138, 43, 226) -- Purple
        }):Play()
    end)
    
    button.Button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple
        }):Play()
    end)
    
    button.Button.MouseButton1Click:Connect(function()
        onClick(button)
    end)
    
    button.Parent = ButtonsPanel
end

-- Hook remotes with anti-detection
local function setupSpyHooks()
    if isSpyActive then return end
    
    local mt = getrawmetatable(game)
    local originalNamecall = mt.__namecall
    
    setreadonly(mt, false)
    
    mt.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        
        -- Check for remote events
        if (method == "FireServer" or method == "InvokeServer") and 
           (self.ClassName == "RemoteEvent" or self.ClassName == "RemoteFunction") then
            
            local remoteName = tostring(self)
            
            -- Anti-gcinfo detection: process in separate thread with delay
            spawn(function()
                wait(0.1) -- Delay to avoid detection
                
                -- Light processing to avoid memory spikes
                local processedArgs = {}
                for i, v in ipairs(args) do
                    if i <= 3 then -- Limit to 3 args
                        table.insert(processedArgs, lightCopy(v))
                    end
                end
                
                -- Add to logs
                addRemoteLog(
                    self.ClassName == "RemoteEvent" and "event" or "function",
                    remoteName,
                    self,
                    processedArgs
                )
            end)
        end
        
        return originalNamecall(self, ...)
    end)
    
    setreadonly(mt, true)
    isSpyActive = true
end

-- Remove hooks
local function removeSpyHooks()
    if not isSpyActive then return end
    
    -- Restore original namecall
    local mt = getrawmetatable(game)
    setreadonly(mt, false)
    -- Note: We don't restore the original to avoid detection
    setreadonly(mt, true)
    
    isSpyActive = false
end

-- Toggle spy
local function toggleSpy()
    if isSpyActive then
        removeSpyHooks()
        StatusBtn.Text = "INACTIVE"
        StatusBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        }):Play()
    else
        setupSpyHooks()
        StatusBtn.Text = "ACTIVE"
        StatusBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
        if not isWindowVisible then
            TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(75, 0, 130)
            }):Play()
        end
    end
end

-- Toggle window
local function toggleWindow()
    isWindowVisible = not isWindowVisible
    
    if isWindowVisible then
        MainWindow.Visible = true
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 550, 0, 400)
        }):Play()
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(138, 43, 226) -- Bright Purple
        }):Play()
    else
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(75, 0, 130) -- Dark Purple
        }):Play()
        
        delay(0.3, function()
            MainWindow.Visible = false
        end)
    end
end

-- Setup button dragging
local isDraggingBtn = false
local dragStartPos = nil
local btnStartPos = nil

ToggleBtn.MouseButton1Down:Connect(function(input)
    isDraggingBtn = true
    dragStartPos = input.Position
    btnStartPos = ToggleBtn.Position
end)

ToggleBtn.MouseButton1Up:Connect(function()
    isDraggingBtn = false
end)

ToggleBtn.MouseMoved:Connect(function(input)
    if isDraggingBtn then
        local delta = input.Position - dragStartPos
        local newPos = UDim2.new(
            btnStartPos.X.Scale,
            btnStartPos.X.Offset + delta.X,
            btnStartPos.Y.Scale,
            btnStartPos.Y.Offset + delta.Y
        )
        
        -- Keep within screen bounds
        local viewport = workspace.CurrentCamera.ViewportSize
        local btnSize = ToggleBtn.AbsoluteSize
        
        local x = math.clamp(newPos.X.Offset, 0, viewport.X - btnSize.X)
        local y = math.clamp(newPos.Y.Offset, 0, viewport.Y - btnSize.Y)
        
        ToggleBtn.Position = UDim2.new(0, x, 0, y)
    end
end)

-- Connect events
ToggleBtn.MouseButton1Click:Connect(toggleWindow)
StatusBtn.MouseButton1Click:Connect(toggleSpy)
CloseBtn.MouseButton1Click:Connect(toggleWindow)



-- Add function buttons
createButton("Copy Script", function() return "Copy current script to clipboard" end, function()
    setclipboard(CodeBox.Text)
    
    -- Visual feedback
    local originalText = StatusBtn.Text
    StatusBtn.Text = "COPIED!"
    delay(1, function()
        if StatusBtn then
            StatusBtn.Text = originalText
        end
    end)
end)

createButton("Execute", function() return "Execute the generated script" end, function()
    local success, result = pcall(loadstring(CodeBox.Text))
    if success then
        CodeBox.Text = CodeBox.Text .. "\n\n-- Execution successful!"
    else
        CodeBox.Text = CodeBox.Text .. "\n\n-- Execution failed: " .. tostring(result)
    end
end)

createButton("Clear Logs", function() return "Clear all remote logs" end, function()
    remoteLogs = {}
    for _, child in pairs(LogsList:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    CodeBox.Text = "-- Logs cleared"
    selectedRemote = nil
end)

createButton("Save Session", function() return "Save current session data" end, function()
    local sessionData = {
        timestamp = os.time(),
        sessionKey = sessionKey,
        logCount = #remoteLogs,
        active = isSpyActive
    }
    
    CodeBox.Text = "-- Session Data:\n" .. HttpService:JSONEncode(sessionData) .. "\n\n" .. CodeBox.Text
end)

createButton("Test Mode", function() return "Test anti-detection systems" end, function()
    -- Simulate a remote call without triggering detection
    local testRemote = Instance.new("RemoteEvent")
    testRemote.Name = "TestRemote_" .. sessionKey
    
    local testArgs = {
        "Test argument 1",
        12345,
        true,
        Vector3.new(1, 2, 3),
        Color3.new(1, 0, 0)
    }
    
    addRemoteLog("event", testRemote.Name, testRemote, testArgs)
    
    CodeBox.Text = "-- Anti-detection test complete\n-- Session: " .. sessionKey
end)

-- Start spy automatically
setupSpyHooks()

-- Add GUI to CoreGui
if syn and syn.protect_gui then
    pcall(syn.protect_gui, DevilSpy)
end

DevilSpy.Parent = gethui and gethui() or CoreGui

print("ðŸ”¥ Devil Spy v3.0 loaded successfully!")
print("ðŸ“¡ Session ID: " .. sessionKey)
print("ðŸ‘¿ Toggle button is purple circle")

-- Anti-detection cleanup thread
spawn(function()
    while true do
        wait(30)
        safeGCMonitor()
        
        -- Periodically clear buffer to prevent memory buildup
        if #gcBuffer > 0 then
            for i = 1, math.min(20, #gcBuffer) do
                table.remove(gcBuffer, 1)
            end
        end
    end
end)
